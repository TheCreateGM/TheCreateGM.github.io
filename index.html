<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Terminal Portfolio :: AxoGM</title>

        <!-- Tailwind CSS CDN -->
        <script src="https://cdn.tailwindcss.com?plugins=typography"></script>

        <!-- Vue.js 3 CDN -->
        <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>

        <!-- jQuery CDN REMOVED - Not actively used, optimizing dependencies -->
        <!-- <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script> -->

        <!-- Google Fonts (Fira Code) -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap" rel="stylesheet">

        <style>
            /* Define custom CSS variables for theme colors */
            :root {
                --color-background: #1a1b26; /* Tokyo Night background */
                --color-text: #c0caf5;       /* Default text */
                --color-black: #15161e;      /* Darker black */
                --color-red: #f7768e;        /* Red */
                --color-green: #9ece6a;      /* Green */
                --color-yellow: #e0af68;     /* Yellow */
                --color-blue: #7aa2f7;       /* Blue */
                --color-magenta: #bb9af7;    /* Magenta */
                --color-cyan: #7dcfff;       /* Cyan */
                --color-white: #a9b1d6;      /* Brighter white/text */
                --color-dim: #5c6370;        /* Dim color */
            }

            body {
                font-family: "Fira Code", "Courier New", Courier, monospace;
                background-color: var(--color-background);
                color: var(--color-text);
                line-height: 1.5; /* Improved spacing */
            }

            /* Custom Scrollbar (Tailwind doesn't handle easily) */
            ::-webkit-scrollbar { width: 10px; }
            ::-webkit-scrollbar-track { background: var(--color-black); }
            ::-webkit-scrollbar-thumb {
                background-color: var(--color-green); border-radius: 5px; border: 2px solid var(--color-black);
            }
            html { scrollbar-width: thin; scrollbar-color: var(--color-green) var(--color-black); }

            /* --- Specific element styling using CSS variables --- */
            .prompt-user { color: var(--color-magenta); }
            .prompt-host { color: var(--color-cyan); }
            .prompt-path { color: var(--color-blue); }
            .prompt-char { color: var(--color-green); }

            .output-error   { color: var(--color-red); }
            .output-success { color: var(--color-green); }
            .output-warning { color: var(--color-yellow); }
            .output-info    { color: var(--color-blue); }
            .output-cyan    { color: var(--color-cyan); }
            .output-blue    { color: var(--color-blue); }
            .output-magenta { color: var(--color-magenta); }
            .output-yellow  { color: var(--color-yellow); }
            .output-red     { color: var(--color-red); }
            .output-dim     { color: var(--color-dim); }
            .output-directory { color: var(--color-cyan); font-weight: bold;}
            .output-file { color: var(--color-white); }

            .neofetch-key {
                color: var(--color-cyan);
                font-weight: bold;
                min-width: 85px; /* Adjusted alignment */
                display: inline-block;
                margin-right: 0.5rem;
            }
        </style>
        <script>
            // Configure Tailwind to understand our theme colors via CSS variables
             tailwind.config = {
                theme: { extend: {
                        colors: {
                            // Map names to the CSS variables for Tailwind utility classes
                            background: 'var(--color-background)', text: 'var(--color-text)',
                            black: 'var(--color-black)', red: 'var(--color-red)',
                            green: 'var(--color-green)', yellow: 'var(--color-yellow)',
                            blue: 'var(--color-blue)', magenta: 'var(--color-magenta)',
                            cyan: 'var(--color-cyan)', white: 'var(--color-white)',
                            dim: 'var(--color-dim)',
                            'prompt-user': 'var(--color-magenta)', 'prompt-host': 'var(--color-cyan)',
                            'prompt-path': 'var(--color-blue)', 'prompt-char': 'var(--color-green)',
                            'command': 'var(--color-white)', 'link': 'var(--color-blue)',
                            'cursor': 'var(--color-green)',
                            'neofetch-key': 'var(--color-cyan)',
                            'value': 'var(--color-white)'
                        },
                        fontFamily: { mono: ['Fira Code', 'Courier New', 'monospace'], }
                    } } }
        </script>
    </head>
    <body class="bg-background text-text font-mono text-[15px] leading-normal antialiased">

        <div id="app" class="h-screen flex flex-col" @click="focusInput">

            <!-- Terminal Output Area -->
            <div ref="terminal" class="flex-grow overflow-y-auto overflow-x-hidden p-3 md:p-4">
                 <div v-for="line in outputLines" :key="line.id" class="output-line mb-1 min-h-[1.5em] break-words">

                    <!-- Neofetch Style Block -->
                    <div v-if="line.type === 'neofetch'" class="flex flex-col sm:flex-row gap-4 md:gap-6 mb-2">
                        <div class="flex-shrink-0 mx-auto sm:mx-0">
                             <!-- Use a placeholder if icon.png not found. Create placeholder.png or remove onerror -->
                             <img :src="line.data.imgPath"
                                  @error="($event) => { $event.target.style.display='none'; console.warn('icon.png not found.') }"
                                  alt="Icon"
                                  class="w-24 h-auto md:w-32 object-contain">
                        </div>
                        <div class="flex-grow min-w-0"> <!-- Added min-w-0 for flex wrapping -->
                             <div class="mb-1">
                                <span class="text-prompt-user font-bold">{{ line.data.user }}</span><span class="text-text">@</span><span class="text-prompt-host">{{ line.data.host }}</span>
                             </div>
                            <div class="border-b border-dim/50 w-1/2 mb-2"></div> <!-- Dimmer border -->
                             <div v-for="item in line.data.info" :key="item.key" class="flex items-start text-sm md:text-[15px]">
                                 <span class="neofetch-key flex-shrink-0">{{ item.key }}:</span>
                                 <!-- v-html needed for links, ensure content is trusted -->
                                 <span class="text-value break-all" v-html="item.value"></span>
                             </div>
                        </div>
                     </div>

                    <!-- Regular Command Echo -->
                    <span v-else-if="line.type === 'command-echo'" class="opacity-90" v-html="line.html"></span>
                     <!-- Other Output types -->
                    <span v-else :class="['output-text', line.type ? 'output-' + line.type : '']" v-html="line.html"></span>
                 </div>
            </div>

            <!-- Input Line -->
            <div class="prompt-line flex items-baseline mt-1 p-3 md:p-4 pt-0 flex-shrink-0">
                 <span class="prompt mr-2 whitespace-nowrap">
                     <span class="prompt-user font-bold">{{ promptUser }}</span><span class="text-text">@</span><span class="prompt-host">{{ promptHost }}</span><span class="text-text">:</span><span class="prompt-path">{{ currentPath }}</span><span class="prompt-char font-bold ml-px">{{ promptChar }}</span>
                 </span>
                 <input
                    ref="commandInput"
                    type="text"
                    class="bg-transparent border-none text-command flex-grow outline-none p-0 h-[1.5em] min-w-0 font-mono text-[15px] caret-cursor"
                    v-model="currentCommand"
                    @keydown.enter.prevent="handleEnter"
                    @keydown.up.prevent="handleArrowUp"
                    @keydown.down.prevent="handleArrowDown"
                    @keydown.tab.prevent="handleTab"
                    @keydown.ctrl.l.prevent="clearOutput"
                    autofocus autocomplete="off" spellcheck="false" autocapitalize="none"
                 />
            </div>
        </div>

        <script>
            const { createApp, ref, reactive, nextTick, onMounted } = Vue;
            const initialLoadTime = Date.now();

            createApp({
                setup() {
                    // --- Reactive State ---
                    const outputLines = ref([]);
                    const currentCommand = ref('');
                    const commandHistory = reactive([]);
                    const historyIndex = ref(-1);
                    const fetchedProjects = ref(null);
                    const githubUsername = ref(null);

                    // --- Constants & Config ---
                    const promptUser = "user";
                    const promptHost = "portfolio";
                    const currentPath = ref("~");
                    const promptChar = "$";
                    const portfolioData = reactive({ // Define static portfolio data here
                        name: "AxoGM",
                        title: "Developer | Planning | Working on Project",
                        contact: { email: "creategm10@gmail.com" },
                        social: {
                            github: "https://github.com/TheCreateGM",
                            linkedin: "https://www.linkedin.com/in/axo-gm-9758832b0/",
                            website: "http://axogmweb.unaux.com"
                        },
                        about: [ /* Shortened for brevity */
                            "Interactive terminal portfolio.",
                            "Use 'help' for commands.",
                        ],
                         skills: [ "JavaScript", "Python", "HTML/CSS", "Vue.js", "Node.js", "Git"],
                         // No banner text needed now
                    });

                    // --- Template Refs ---
                    const terminal = ref(null);
                    const commandInput = ref(null);

                    // --- Core Methods ---
                    const focusInput = () => commandInput.value?.focus();
                    const scrollToBottom = () => { // Scrolls if near bottom
                         nextTick(() => {
                           const el = terminal.value;
                           if (el) {
                                const buffer = 60; // Px buffer
                                const isScrolledToBottom = el.scrollHeight - el.clientHeight <= el.scrollTop + buffer;
                                if (isScrolledToBottom || el.scrollHeight <= el.clientHeight) {
                                    el.scrollTop = el.scrollHeight;
                                }
                            }
                        });
                    };

                    const appendOutput = (content, type = "text") => { // Handles different output types
                        const newId = Date.now() + Math.random();
                        if (type === 'neofetch') {
                            if (typeof content !== 'object' || !content.imgPath) {
                                console.error("Invalid data provided for neofetch type:", content);
                                outputLines.value.push({ id: newId, type: 'error', html: "Error: Invalid banner data."});
                            } else {
                                outputLines.value.push({ id: newId, type: 'neofetch', data: content });
                            }
                        } else {
                            outputLines.value.push({ id: newId, type, html: String(content) });
                        }
                        scrollToBottom();
                    };

                    const getPromptHtml = () => { // Generates prompt HTML for echo
                        return `<span class="prompt mr-2 whitespace-nowrap"><span class="prompt-user font-bold">${promptUser}</span><span class="text-text">@</span><span class="prompt-host">${promptHost}</span><span class="text-text">:</span><span class="prompt-path">${currentPath.value}</span><span class="prompt-char font-bold ml-px">${promptChar}</span></span>`;
                     };

                     const runCommand = (commandName, args) => { // Executes command logic
                          if (commands[commandName]) {
                             try { commands[commandName](args); } catch (error) {
                                console.error(`Cmd Err [${commandName}]:`, error);
                                appendOutput(`Runtime error: ${error.message}`, "error");
                             }
                         } else { appendOutput(`command not found: ${commandName}`, "error"); }
                     };

                     const processCurrentCommand = () => { // Handles 'Enter' key press
                         const commandStr = currentCommand.value.trim();
                         if (!commandStr) { scrollToBottom(); return; }

                         if (!commandHistory.includes(commandStr)) {
                             commandHistory.push(commandStr);
                         }
                         historyIndex.value = commandHistory.length; // Reset history index

                         appendOutput(`${getPromptHtml()} <span class="text-command">${currentCommand.value}</span>`, "command-echo");
                         const parts = commandStr.split(" ");
                         runCommand(parts[0].toLowerCase(), parts.slice(1));

                         currentCommand.value = ""; // Clear input
                         scrollToBottom();
                    };
                    const clearOutput = () => { outputLines.value = []; };

                    const getUptime = () => { // Calculates uptime string
                        const uptimeMs = Date.now() - initialLoadTime;
                        const seconds = Math.floor(uptimeMs / 1000) % 60;
                        const minutes = Math.floor(uptimeMs / (1000 * 60)) % 60;
                        const hours = Math.floor(uptimeMs / (1000 * 60 * 60));
                        let str = `${seconds}s`;
                        if (minutes > 0 || hours > 0) str = `${minutes}m ` + str;
                        if (hours > 0) str = `${hours}h ` + str;
                        return str;
                    };

                    // --- Command Definitions ---
                     const commands = {
                         help: () => { /* Unchanged */
                            const available = Object.keys(commands).sort().join("  ");
                            appendOutput("Available commands:", "info"); appendOutput(available, "text");
                            appendOutput(`\nUp/Down for history, Tab complete, Ctrl+L clear.`, "dim");
                         },
                         about: () => { /* Unchanged */
                            appendOutput(`--- About ${portfolioData.name} ---`, "info");
                            if (portfolioData.title) appendOutput(`${portfolioData.title}`, "cyan");
                            portfolioData.about.forEach(line => appendOutput(`> ${line}`));
                         },
                         banner: () => { // Constructs and outputs Neofetch data
                             // Simulate simple OS detection (very basic)
                             let os = "WebApp";
                             const ua = navigator.userAgent;
                             if (ua.includes("Win")) os = "Windows";
                             else if (ua.includes("Mac")) os = "MacOS";
                             else if (ua.includes("Linux")) os = "Linux";
                             else if (ua.includes("Android")) os = "Android";
                             else if (ua.includes("like Mac")) os = "iOS"; // Basic iOS detection

                             const neofetchData = {
                                imgPath: './icon.png', // Ensure this exists!
                                user: promptUser, host: promptHost,
                                info: [
                                     { key: "OS", value: os }, // Simulated OS
                                    { key: "Portfolio", value: portfolioData.name },
                                     { key: "Status", value: portfolioData.title },
                                     // Using v-html for these values with links
                                    { key: "Contact", value: `<a href="mailto:${portfolioData.contact.email}" class="text-link underline hover:no-underline">${portfolioData.contact.email}</a>` },
                                    { key: "GitHub", value: `<a href="${portfolioData.social.github}" target="_blank" class="text-link underline hover:no-underline">${portfolioData.social.github}</a>` },
                                     { key: "LinkedIn", value: `<a href="${portfolioData.social.linkedin}" target="_blank" class="text-link underline hover:no-underline">Visit Profile</a>` },
                                     { key: "Skills", value: (portfolioData.skills || []).slice(0, 6).join(', ') + (portfolioData.skills.length > 6 ? '...' : '') },
                                     { key: "Shell", value: "VueTerm" },
                                    { key: "Uptime", value: getUptime() },
                                     { key: "Theme", value: "TokyoNight-ish" } // Fun detail
                                 ]
                             };
                             appendOutput(neofetchData, 'neofetch');
                         },
                         projects: () => { // Renders fetched GitHub projects
                             appendOutput("--- GitHub Projects ---", "info");
                             const projects = fetchedProjects.value;
                             if (projects instanceof Error) appendOutput(`Error: ${projects.message}`, "error");
                             else if (projects === null) appendOutput("Loading projects or fetch failed...", "warning");
                             else if (!Array.isArray(projects)) appendOutput("Project data format error.", "error");
                             else if (projects.length === 0) appendOutput(`No public repositories found.`, "warning");
                             else {
                                 projects.forEach(p => { /* ... Existing project formatting logic ... */
                                    let langClass = 'dim'; /* ... */
                                    if (p.language) { const langLower = p.language.toLowerCase(); if (langLower === 'javascript') langClass = 'yellow'; else if (langLower === 'python') langClass = 'blue'; else if (langLower === 'html') langClass = 'red'; else if (langLower === 'css') langClass = 'magenta'; else if (langLower === 'typescript') langClass = 'blue'; else if (langLower === 'shell') langClass = 'green'; }
                                    let lineHtml = ` <span class="output-success">•</span> <span class="output-file">${p.name}</span> <span class="output-${langClass}">[${p.language}]</span> <span class="output-yellow">(★ ${p.stars})</span>: ${p.description}`;
                                    if (p.url) lineHtml += ` (<a href="${p.url}" target="_blank" class="text-link underline hover:no-underline">Link</a>)`; // Shorter link text
                                    appendOutput(lineHtml);
                                 });
                                 appendOutput(`\n(Showing top ${projects.length} updated public repos)`, "dim");
                             }
                         },
                        contact: () => { /* Unchanged */
                             appendOutput("--- Contact ---", "info");
                             if (portfolioData.contact.email) appendOutput(`Email: <a href="mailto:${portfolioData.contact.email}" class="text-link underline hover:no-underline">${portfolioData.contact.email}</a>`);
                             else appendOutput("No email provided.", "warning");
                         },
                        social: () => { /* Unchanged */
                             appendOutput("--- Social Links ---", "info");
                             const entries = Object.entries(portfolioData.social);
                             if (entries.length === 0) appendOutput("None provided.", "warning");
                             else entries.forEach(([p, url]) => {
                                 if (url) appendOutput(`<span class="output-cyan">${p.charAt(0).toUpperCase() + p.slice(1)}:</span> <a href="${url}" target="_blank" class="text-link underline hover:no-underline">${url}</a>`);
                             });
                         },
                         skills: () => { /* Unchanged */
                            appendOutput("--- Skills ---", "info");
                            if (!portfolioData.skills?.length) appendOutput("None listed.", "warning");
                            else {
                               const skillsHtml = portfolioData.skills.map((skill, i) => { const cls = i % 3 === 0 ? 'cyan' : (i % 3 === 1 ? 'yellow' : 'magenta'); return `<span class="output-${cls}">${skill}</span>`; }).join('<span class="output-dim"> | </span>');
                               appendOutput(skillsHtml);
                            }
                         },
                         clear: clearOutput,
                         date: () => { appendOutput(new Date().toLocaleString(), 'success'); },
                         echo: (args) => { appendOutput(args.join(" ")); },
                         pwd: () => { appendOutput(`/home/${promptUser}`, 'info'); },
                         ls: () => { /* Unchanged */
                            appendOutput("<span class='directory'>drwxr-xr-x</span> about", 'text'); appendOutput("<span class='directory'>drwxr-xr-x</span> projects", 'text'); appendOutput("<span class='file'>-rw-r--r--</span> contact", 'text'); appendOutput("<span class='file'>-rw-r--r--</span> social", 'text'); appendOutput("\nUse commands to view.", "dim");
                         },
                         uname: () => { appendOutput(`VueTerm v2.2 (Vue3/JS)`, 'info'); },
                         whoami: () => { appendOutput(promptUser, 'magenta'); },
                         sudo: () => { appendOutput(`Permission denied. This terminal is secure!`, "error"); },
                     };

                    // --- GitHub Fetch Logic (using native fetch) ---
                    const fetchGitHubProjects = async (username) => {
                         if (!username) return new Error("GitHub username missing.");
                         const apiUrl = `https://api.github.com/users/${username}/repos?sort=updated&direction=desc&per_page=50`;
                         appendOutput(`Fetching repos for ${username}...`, 'warning');
                         try {
                             const response = await fetch(apiUrl); // Native Fetch API
                             if (!response.ok) return new Error(`GitHub API Error: ${response.status} ${response.statusText}`);
                             const data = await response.json();
                             if (!Array.isArray(data)) return new Error("Unexpected API response format.");
                             appendOutput(`Fetched ${data.length} public repos.`, 'success');
                             return data.map(repo => ({ name: repo.name, description: repo.description || "No description.", url: repo.html_url, stars: repo.stargazers_count, language: repo.language || "N/A" }));
                         } catch (error) {
                             console.error("GitHub Fetch Error:", error);
                             const errorMsg = (error instanceof TypeError) ? "Network error or CORS issue." : "Fetch exception.";
                             return new Error(errorMsg);
                         }
                    };

                    // --- Input Event Handlers ---
                    const handleEnter = () => processCurrentCommand();
                    const handleArrowUp = () => { // History up
                        if (commandHistory.length === 0) return;
                        historyIndex.value = Math.max(0, historyIndex.value - 1);
                        currentCommand.value = commandHistory[historyIndex.value] ?? "";
                        nextTick(() => commandInput.value?.setSelectionRange(currentCommand.value.length, currentCommand.value.length));
                     };
                    const handleArrowDown = () => { // History down
                        if (commandHistory.length === 0 || historyIndex.value >= commandHistory.length - 1) {
                            historyIndex.value = commandHistory.length; // Go past end to clear
                            currentCommand.value = "";
                            return;
                        }
                        historyIndex.value++;
                        currentCommand.value = commandHistory[historyIndex.value] ?? "";
                        nextTick(() => commandInput.value?.setSelectionRange(currentCommand.value.length, currentCommand.value.length));
                     };
                    const handleTab = () => { // Autocompletion
                         const inputVal = currentCommand.value.trim().toLowerCase().split(" ")[0];
                         if (!inputVal) return;
                         const possibilities = Object.keys(commands).filter(cmd => cmd.startsWith(inputVal));
                         if (possibilities.length === 1) { currentCommand.value = possibilities[0] + " "; }
                         else if (possibilities.length > 1) {
                             appendOutput(`${getPromptHtml()} <span class="text-command">${currentCommand.value}</span>`, "command-echo");
                             appendOutput(possibilities.join("    "), "info");
                         }
                     };

                    // --- Component Lifecycle Hook (Initialization) ---
                    onMounted(async () => {
                        console.log("Initializing Vue Terminal...");
                        commands.banner(); // Run Neofetch banner on load

                        // Fetch GitHub Data
                        let ghUser = null;
                        if (portfolioData.social?.github) {
                            try {
                                const url = new URL(portfolioData.social.github);
                                ghUser = url.pathname.split('/').filter(Boolean).pop();
                                if(!ghUser) throw new Error("Cannot extract user");
                            } catch(e) { appendOutput(`Warning: Invalid GitHub URL`, "warning"); }
                        }

                        if (ghUser) {
                             githubUsername.value = ghUser; // Store detected username
                             fetchedProjects.value = await fetchGitHubProjects(ghUser);
                             if (fetchedProjects.value instanceof Error) { // Append error msg if fetch failed
                                appendOutput(`Error fetching projects: ${fetchedProjects.value.message}`, "error");
                             }
                        } else {
                            appendOutput("GitHub user not configured. 'projects' unavailable.", "warning");
                            fetchedProjects.value = new Error("GitHub user not configured.");
                        }

                        appendOutput(`Type 'help' for commands.`, "success"); // Final message
                        focusInput();
                        scrollToBottom();
                        console.log("Terminal Initialized.");
                    });

                    // --- Expose to Template ---
                    return {
                        outputLines, currentCommand, promptUser, promptHost,
                        currentPath, promptChar, terminal, commandInput,
                        focusInput, handleEnter, handleArrowUp, handleArrowDown,
                        handleTab, clearOutput
                    };
                }
            }).mount('#app');

        </script>
    </body>
</html>
